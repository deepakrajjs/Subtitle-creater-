<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Video Transcript Summarizer</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: #f0f0f0;
      color: #333;
    }
    header {
      background: #3b82f6;
      color: white;
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
    }
    main {
      display: flex;
      flex-direction: column;
      padding: 1rem;
      max-width: 900px;
      margin: auto;
    }
    input, button {
      margin-top: 1rem;
    }
    .output {
      background: white;
      padding: 1rem;
      border-radius: 8px;
      margin-top: 1rem;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    .timestamp {
      color: #3b82f6;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>AI Video Transcript Summarizer</header>
  <main>
    <input type="url" id="fileUrl" placeholder="Paste your public audio/video URL here" style="width:100%;padding:10px;">
    <button onclick="transcribe()">Start Transcription</button>

    <div class="output" id="transcriptSection">
      <h3>Transcript</h3>
      <div id="transcript"></div>
    </div>

    <div class="output" id="keypointsSection">
      <h3>Key Points</h3>
      <ul id="keypoints"></ul>
    </div>

    <button onclick="downloadTranscript()">Download Transcript</button>
    <button onclick="readKeyPoints()">ðŸ”Š Read Key Points</button>
    <audio id="ttsAudio" controls style="display:none;"></audio>
  </main>

  <script>
    let transcriptText = '';

    async function transcribe() {
      const fileUrl = document.getElementById("fileUrl").value.trim();
      if (!fileUrl) return alert("Please paste a valid public URL to your audio/video file");

      const apiUrl = `https://speech-to-text-ai.p.rapidapi.com/transcribe?url=${encodeURIComponent(fileUrl)}&lang=en&task=transcribe`;

      const options = {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
          'x-rapidapi-host': 'speech-to-text-ai.p.rapidapi.com',
          'x-rapidapi-key': 'a1d116da16msh51a941754e93974p1374c6jsnf7296de5ccf6'
        }
      };

      document.getElementById("transcript").innerHTML = 'Processing...';

      try {
        const res = await fetch(apiUrl, options);
        const data = await res.json();
        const transcript = data.text;

        transcriptText = transcript;
        const lines = transcript.split('.').filter(l => l.trim().length > 0);
        const transcriptDiv = document.getElementById("transcript");
        transcriptDiv.innerHTML = '';
        lines.forEach((line, i) => {
          const time = `[${Math.floor(i * 3 / 60).toString().padStart(2,'0')}:${(i * 3 % 60).toString().padStart(2,'0')}]`;
          const div = document.createElement("div");
          div.innerHTML = `<span class="timestamp">${time}</span> ${line.trim()}`;
          transcriptDiv.appendChild(div);
        });

        const keyPoints = lines.filter(l => l.length > 40).slice(0, 5);
        const keyList = document.getElementById("keypoints");
        keyList.innerHTML = '';
        keyPoints.forEach(p => {
          const li = document.createElement("li");
          li.textContent = p.trim();
          keyList.appendChild(li);
        });

      } catch (error) {
        console.error(error);
        alert("Error transcribing. Try again.");
      }
    }

    function downloadTranscript() {
      const blob = new Blob([transcriptText], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'transcript.txt';
      a.click();
    }

    async function readKeyPoints() {
      const keyList = document.querySelectorAll("#keypoints li");
      const inputText = Array.from(keyList).map(li => li.textContent).join(". ");
      if (!inputText) return alert("No key points available to read.");

      const body = {
        model: "tts-1",
        input: inputText,
        instructions: "Speak in a lively and optimistic tone.",
        voice: "alloy"
      };

      try {
        const response = await fetch("https://open-ai-text-to-speech1.p.rapidapi.com/", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "x-rapidapi-host": "open-ai-text-to-speech1.p.rapidapi.com",
            "x-rapidapi-key": "a1d116da16msh51a941754e93974p1374c6jsnf7296de5ccf6"
          },
          body: JSON.stringify(body)
        });

        const data = await response.blob();
        const audioUrl = URL.createObjectURL(data);
        const audio = document.getElementById("ttsAudio");
        audio.src = audioUrl;
        audio.style.display = "block";
        audio.play();
      } catch (err) {
        console.error(err);
        alert("Failed to convert text to speech.");
      }
    }
  </script>
</body>
</html>
