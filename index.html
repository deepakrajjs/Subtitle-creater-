<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Frontend AI Transcript Summarizer</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 1rem; background: #f9f9f9; }
    input, button { margin-top: 1rem; padding: 0.5rem; }
    .output { background: #fff; padding: 1rem; margin-top:1rem; border-radius:5px; }
    .timestamp { color: #007bff; cursor: pointer; }
  </style>
</head>
<body>
  <h2>AI Video Transcript Summarizer</h2>
  <input type="file" id="videoFile" accept="video/*" /><br/>
  <button id="processBtn" disabled>Upload & Transcribe</button>
  <video id="video" controls style="width:100%; margin-top:1rem;"></video>

  <div class="output"><h3>Transcript</h3><div id="transcript"></div></div>
  <div class="output"><h3>Key Points</h3><ul id="keypoints"></ul></div>

  <button onclick="downloadTranscript()">ðŸ“„ Download Transcript</button>
  <button onclick="readKeyPoints()">ðŸ”Š Read Key Points</button>
  <audio id="ttsAudio" controls style="display:none; margin-top:1rem;"></audio>

<script>
const videoFileInput = document.getElementById('videoFile');
const processBtn = document.getElementById('processBtn');
const video = document.getElementById('video');
let transcriptText='';

videoFileInput.onchange = () => {
  processBtn.disabled = false;
  const file = videoFileInput.files[0];
  if (file) video.src = URL.createObjectURL(file);
};

processBtn.onclick = async () => {
  const file = videoFileInput.files[0];
  if (!file) return alert("Please select a video file.");

  processBtn.disabled = true;
  const form = new FormData();
  form.append('file', file);
  try {
    // ðŸŽ¯ Step 1: Upload to file.io
    const resUp = await fetch('https://file.io', { method:'POST', body: form });
    const jsonUp = await resUp.json();
    const publicUrl = jsonUp.link;
    if (!publicUrl) throw new Error("Upload failed");

    // ðŸŽ¯ Step 2: Transcribe
    const api = `https://speech-to-text-ai.p.rapidapi.com/transcribe?url=${encodeURIComponent(publicUrl)}&lang=en&task=transcribe`;
    const res = await fetch(api, {
      method: 'POST',
      headers: {
        'Content-Type':'application/x-www-form-urlencoded',
        'x-rapidapi-host':'speech-to-text-ai.p.rapidapi.com',
        'x-rapidapi-key':'a1d116da16msh51a941754e93974p1374c6jsnf7296de5ccf6'
      }
    });
    const data = await res.json();
    const text = data.text || '';
    transcriptText = text.trim();

    // ðŸŽ¯ Display transcript
    const lines = transcriptText.split('.').filter(l=>l.trim());
    const divT = document.getElementById('transcript');
    divT.innerHTML = '';
    lines.forEach((l,i)=>{
      const sec = i*5;
      const mm = String(Math.floor(sec/60)).padStart(2,'0'), ss=String(sec%60).padStart(2,'0');
      const el = document.createElement('div');
      el.innerHTML = `<span class="timestamp" onclick="seek(${sec})">[${mm}:${ss}]</span> ${l.trim()}.`;
      divT.appendChild(el);
    });

    // ðŸŽ¯ Key points
    const keyp = lines.filter(l=>l.length>60).slice(0,5);
    document.getElementById('keypoints').innerHTML = keyp.map(p=>`<li>${p.trim()}.</li>`).join('');

  } catch(err) {
    console.error(err);
    alert("Error occurred. Check console or ensure file is public.");
  } finally {
    processBtn.disabled = false;
  }
};

function seek(sec) { video.currentTime = sec; video.play(); }

function downloadTranscript() {
  const blob = new Blob([transcriptText],{type:'text/plain'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download='transcript.txt';
  a.click();
}

async function readKeyPoints() {
  const pts = Array.from(document.querySelectorAll('#keypoints li')).map(el=>el.textContent).join(' ');
  if(!pts) return alert("No key points found.");
  const body = { model:"tts-1", input:pts, instructions:"Lively tone", voice:"alloy" };
  try {
    const resp = await fetch("https://open-ai-text-to-speech1.p.rapidapi.com/", {
      method:'POST',
      headers:{
        "Content-Type":"application/json",
        "x-rapidapi-host":"open-ai-text-to-speech1.p.rapidapi.com",
        "x-rapidapi-key":"a1d116da16msh51a941754e93974p1374c6jsnf7296de5ccf6"
      }, body: JSON.stringify(body)
    });
    const blob = await resp.blob();
    const audioUrl = URL.createObjectURL(blob);
    const player = document.getElementById('ttsAudio');
    player.src = audioUrl;
    player.style.display='block';
    player.play();
  } catch(err) {
    console.error(err);
    alert('TTS error.');
  }
}
</script>
</body>
</html>
